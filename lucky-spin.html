<!DOCTYPE html>
<html lang="lo">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- =====================================================
     TITLE
===================================================== -->
<title>àºªàº¸à»ˆàº¡àº¥àº²àº‡àº§àº±àº™ â€“</title>

<!-- =====================================================
     GOOGLE FONT
===================================================== -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<!-- =====================================================
     STYLE
===================================================== -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao&display=swap');

* { font-family: 'Noto Sans Lao', sans-serif; box-sizing: border-box; }

/* =====================================================
   RESET
===================================================== */
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

/* =====================================================
   BODY
===================================================== */
body{
  min-height:100vh;
  background-image: url(li.png);
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
  color:#fff;
  font-family:'Poppins',sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  overflow-x:hidden;
}

/* =====================================================
   HEADER
===================================================== */
h1{
  font-size:42px;
  font-weight:700;
  letter-spacing:4px;
  margin-bottom:18px;
  color:#ffffff;
  text-shadow:
    0 0 15px rgba(255, 0, 0, 0.6),
    0 0 30px rgba(224, 71, 0, 0.973);
}

/* =====================================================
   SLOT MACHINE
===================================================== */
#machine{
  width:900px;
  max-width:95vw;
  height:240px;
  background:linear-gradient(180deg,#ffc933,#ffd900);
  border:3px solid rgb(255, 255, 255);
  border-radius:22px;
  position:relative;
  overflow:hidden;
}

/* =====================================================
   ARROW
===================================================== */
.red-arrow{
  position:absolute;
  top:-18px;
  left:50%;
  transform:translateX(-50%);
  width:0;height:0;
  border-left:16px solid transparent;
  border-right:16px solid transparent;
  border-top:22px solid red;
}

/* =====================================================
   ITEMS
===================================================== */
#items{
  display:flex;
  align-items:center;
  gap:20px;
  padding:0 150px;
  height:100%;
  will-change:transform;
}
.item{
  border:3px solid rgb(255, 255, 255);
  border-radius:22px;
  width:150px;
  height:150px;
  background:#222;
  border-radius:16px;
  overflow:hidden;
  flex-shrink:0;
}
.item img{
  
  width:100%;
  height:100%;
  object-fit:cover;
}
.item.active{
  transform:scale(1.25);
  box-shadow:0 0 40px gold;
}

/* =====================================================
   BUTTON
===================================================== */
#spinBtn{
  margin:20px 0;
  padding:16px 52px;
  font-size:22px;
  font-weight:600;
  border:none;
  border-radius:40px;
  cursor:pointer;
  background:linear-gradient(135deg,#ffd700,#ffae00);
}

/* =====================================================
   CODE DISPLAY
===================================================== */
#lione-addon-code{
  font-size:68px;
  font-weight:700;
  color:#ffffff;
  letter-spacing:6px;
  margin-bottom:10px;
}

/* =====================================================
   POPUP
===================================================== */
#popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0, 0, 0, 0.9);
  z-index:100;
  display:flex;
  align-items:center;
  justify-content:center;
}
#popupBox{
  background:#ffd000;
  border:3px solid gold;
  padding:26px;
  border-radius:22px;
  text-align:center;
}
#popupBox img{width:260px}
#popupCode{margin-top:14px;font-size:34px;color:#ff0000}

</style>
</head>

<body>

<h1>.</h1>

<div id="machine">
  <div class="red-arrow"></div>
  <div id="items"></div>
</div>

<button id="spinBtn">à»€à»€àº¥à»ˆàº™àº”à»‰àº­àº¡</button>
<div id="lione-addon-code">LIONO----</div>

<div id="popup" onclick="this.style.display='none'">
  <div id="popupBox">
    <img id="popupImg">
    <div id="popupCode"></div>
  </div>
</div>

<script>
/* =====================================================
   LOAD DATA
===================================================== */
const rewards = JSON.parse(localStorage.getItem("rewardMap")) || [];

/* =====================================================
   ELEMENTS
===================================================== */
const itemsEl = document.getElementById("items");
const codeEl = document.getElementById("lione-addon-code");
const popup = document.getElementById("popup");
const popupImg = document.getElementById("popupImg");
const popupCode = document.getElementById("popupCode");
const spinBtn = document.getElementById("spinBtn");

/* =====================================================
   CONSTANT
===================================================== */
const ITEM_WIDTH = 150;
const GAP = 20;
const STEP = ITEM_WIDTH + GAP;

/* =====================================================
   STATE
===================================================== */
let currentIndex = 0;
let isSpinning = false;

/* =====================================================
   INIT SLOT
===================================================== */
function initSlot(){
  itemsEl.innerHTML="";
  for(let r=0;r<4;r++){
    rewards.forEach(rew=>{
      const d=document.createElement("div");
      d.className="item";
      d.innerHTML=`<img src="${rew.img}">`;
      itemsEl.appendChild(d);
    });
  }
}
initSlot();

/* =====================================================
   RANDOM CODE ENGINE (FIXED)
===================================================== */
let randomRunning = false;
let randomRAF = null;

function startRandomCode(){
  randomRunning = true;
  function loop(){
    if(!randomRunning) return;
    const n = Math.floor(Math.random()*9999);
    codeEl.innerText = "LIONO" + String(n).padStart(4,"0");
    randomRAF = requestAnimationFrame(loop);
  }
  loop();
}

function stopRandomCode(finalCode){
  randomRunning = false;
  if(randomRAF) cancelAnimationFrame(randomRAF);
  codeEl.innerText = finalCode;
}

/* =====================================================
   GOOGLE TTS
===================================================== */
function speakWinner(code){
  if(!('speechSynthesis'in window))return;
  speechSynthesis.cancel();

  const mapL={
    A:"à¹€à¸­",B:"à¸šà¸µ",C:"à¸‹à¸µ",D:"à¸”à¸µ",E:"à¸­à¸µ",F:"à¹€à¸­à¸Ÿ",
    G:"à¸ˆà¸µ",H:"à¹€à¸­à¸Š",I:"à¹„à¸­",J:"à¹€à¸ˆ",K:"à¹€à¸„",L:"à¹à¸­à¸¥",
    M:"à¹€à¸­à¹‡à¸¡",N:"à¹€à¸­à¹‡à¸™",O:"à¹‚à¸­",P:"à¸žà¸µ",Q:"à¸„à¸´à¸§",
    R:"à¸­à¸²à¸£à¹Œ",S:"à¹€à¸­à¸ª",T:"à¸—à¸µ",U:"à¸¢à¸¹",V:"à¸§à¸µ",
    W:"à¸”à¸±à¸šà¹€à¸šà¸´à¸¥à¸¢à¸¹",X:"à¹€à¸­à¹‡à¸à¸‹à¹Œ",Y:"à¸§à¸²à¸¢",Z:"à¹à¸‹à¸”"
  };
  const mapN={
    0:"à¸¨à¸¹à¸™à¸¢à¹Œ",1:"à¸«à¸™à¸¶à¹ˆà¸‡",2:"à¸ªà¸­à¸‡",3:"à¸ªà¸²à¸¡",4:"à¸ªà¸µà¹ˆ",
    5:"à¸«à¹‰à¸²",6:"à¸«à¸",7:"à¹€à¸ˆà¹‡à¸”",8:"à¹à¸›à¸”",9:"à¹€à¸à¹‰à¸²"
  };

  const spoken = code.toUpperCase().split("").map(c=>{
    if(mapL[c]) return mapL[c];
    if(mapN[c]) return mapN[c];
    return c;
  }).join(" , ");

  const u=new SpeechSynthesisUtterance(`${spoken} , à¹„à¸”à¹‰à¸£à¸±à¸šà¸£à¸²à¸‡à¸§à¸±à¸¥`);
  u.lang="th-TH";
  u.rate=1.4;
  speechSynthesis.speak(u);
}

/* =====================================================
   SPIN LOGIC (+30%)
===================================================== */
spinBtn.onclick = ()=>{
  if(isSpinning || rewards.length===0) return;
  isSpinning=true;

  const reward = rewards[currentIndex];

  startRandomCode(); // ðŸ”¥ à¹€à¸£à¸´à¹ˆà¸¡à¸ªà¸¸à¹ˆà¸¡à¸£à¸«à¸±à¸ªà¸—à¸±à¸™à¸—à¸µ

  itemsEl.style.transition="none";
  itemsEl.style.transform="translateX(0)";

  setTimeout(()=>{
    const stopX =
      (rewards.length*2 + currentIndex)*STEP
      - machine.offsetWidth/2 + ITEM_WIDTH/2;

    itemsEl.style.transition =
      "transform 7.8s cubic-bezier(.05,.85,.1,1)";
    itemsEl.style.transform = `translateX(-${stopX}px)`;
  },50);

  setTimeout(()=>{
    stopRandomCode(reward.code); // ðŸ”¥ à¸«à¸¢à¸¸à¸”à¸ªà¸¸à¹ˆà¸¡à¸•à¸£à¸‡à¸ˆà¸±à¸‡à¸«à¸§à¸°

    popupImg.src = reward.img;
    popupCode.innerText = reward.code;
    popup.style.display = "flex";

    speakWinner(reward.code);

    currentIndex = (currentIndex+1) % rewards.length;
    isSpinning=false;
  },8500);
};
</script>

</body>
</html>
