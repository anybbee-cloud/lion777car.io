<!DOCTYPE html>
<html lang="lo">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lucky Spin ‚Äì FULL COMBINED (SYNC SOUND)</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* ======================================================
   GLOBAL FONT & RESET
====================================================== */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans Lao','Poppins',sans-serif}

/* ======================================================
   THEME VARIABLES
====================================================== */
:root{
  --bg:#020617;
  --card:#0f172a;
  --gold:#facc15;
  --orange:#f97316;
  --text:#e5e7eb;
}

/* ======================================================
   BODY
====================================================== */
body{
  min-height:100vh;
  background: #000 url(li.png) center / cover no-repeat;
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  overflow-x:hidden;
}

/* ======================================================
   LAYOUT WRAP
====================================================== */
.page{
  width:100%;
  max-width:1400px;
  padding:24px;
  display:grid;
  grid-template-columns: 360px 1fr 360px;
  gap:20px;
}
@media(max-width:1200px){
  .page{grid-template-columns:1fr}
}

/* ======================================================
   PRIZE TABLE
====================================================== */
.prize-card{
  background:linear-gradient(180deg,#020617,#020617) padding-box,
             linear-gradient(135deg,var(--gold),var(--orange)) border-box;
  border:2px solid transparent;
  border-radius:18px;
  box-shadow:0 30px 60px rgba(0,0,0,.5);
  overflow:hidden;
}
.prize-card h2{
  text-align:center;
  padding:16px;
  background:linear-gradient(135deg,var(--gold),var(--orange));
  color:#000;
}
table{width:100%;border-collapse:collapse}
th,td{padding:14px;text-align:center}
tbody tr{background:var(--card)}
tbody tr:not(:last-child){border-bottom:1px solid rgba(255,255,255,.06)}
.prize-name{text-align:left;font-weight:600}
.badge{
  display:inline-block;padding:6px 14px;border-radius:999px;
  background:linear-gradient(135deg,#ff9900,#ffc400);
  color:#022c22;font-weight:700;font-size:14px
}
.badge.big{
  /* background:linear-gradient(135deg,#fde047,#f59e0b); */
  color:#422006
}

/* ======================================================
   GAME SCENE
====================================================== */
#gameScene{
  position: relative;
  top: 100px;
  text-align:center;
  perspective:1200px;
  transition:transform 1.2s cubic-bezier(.2,.9,.3,1);
}
#gameScene.zoom-in{transform:scale(1.2) rotateX(6deg)}

h1{
  font-size:36px;
  margin-bottom:12px;
  background: linear-gradient(135deg, #ffffff, #ffffff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* ======================================================
   MACHINE
====================================================== */
#machine{
  width:600px;
  max-width:95vw;
  height:300px;
  margin:0 auto;
  background:#000 url(ccc.png) center/cover no-repeat;
  border:3px solid #fdb42b;
  border-radius:22px;
  overflow:hidden;
  position:relative;
  box-shadow:0 0 40px rgba(255,215,0,.6);
}
.red-arrow{
  position:absolute;
  top:20%;
  left:50%;
  transform:translate(-50%,-100%);
  border-left:16px solid transparent;
  border-right:16px solid transparent;
  border-top:22px solid red;
  z-index:10;
  animation:arrow-bounce .9s ease-in-out infinite;
}
@keyframes arrow-bounce{
  0%,100%{transform:translate(-50%,-100%)}
  50%{transform:translate(-50%,-135%)}
}
#items{
  display:flex;
  align-items:center;
  height:100%;
  gap:20px;
  will-change:transform;
}
.item{
  width:200px;height:200px;
  background:#fff;border-radius:16px;
  overflow:hidden;flex-shrink:0
}
.item img{width:100%;height:100%;object-fit:cover}

/* ======================================================
   CONTROLS
====================================================== */
#spinBtn{
  margin:16px 0;
  padding:16px 52px;
  font-size:22px;
  border-radius:40px;
  border:none;
  cursor:pointer;
  background:#fff;
  color:red;
  box-shadow:0 0 25px rgba(0,0,0,.6);
}
#spinBtn:disabled{opacity:.5}
#lione-addon-code{
  display:inline-block;
  font-size:36px;
  background:linear-gradient(135deg,#ff0000,#a30000);
  padding:10px 30px;
  border-radius:20px;
  letter-spacing:6px;
  box-shadow:0 0 40px rgba(0,0,0,.8);
}

/* ======================================================
   POPUP
====================================================== */
#popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99;
}
#popupBox{
  background:#f17500;
  padding:26px;
  border-radius:22px;
  border:3px solid #fff;
  box-shadow:0 0 40px gold;
  text-align:center;
}
#popupBox img{width:260px;border-radius:14px}
#popupCode{margin-top:14px;font-size:34px}

/* ======================================================
   CONFETTI
====================================================== */
.confetti{
  position:fixed;width:10px;height:14px;top:-20px;
  animation:fall linear forwards;z-index:999
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);opacity:0}
}

/* ======================================================
   HISTORY
====================================================== */
#historyBox{
  background:rgba(0,0,0,.6);
  border:2px solid gold;
  border-radius:18px;
  padding:15px;
}
#historyBox h2{text-align:center;color:#ffd700;margin-bottom:8px}
#clearHistoryBtn{
  display:block;margin:6px auto 12px;
  padding:8px 20px;border-radius:20px;border:none;
  background:linear-gradient(135deg,#ff4d4d,#b30000);
  color:#fff;cursor:pointer
}
.history-item{
  align-items: center;
  display:flex;gap:10px;margin-bottom:10px;
  background:rgba(255,255,255,.08);
  padding:10px;border-radius:12px
}
.history-item img{
  width:60px;height:60px;object-fit:cover;
  border-radius:10px;border:2px solid gold
}

/* ======================================================
   MOBILE
====================================================== */
@media(max-width:768px){
  #machine{height:200px}
  .item{width:120px;height:120px}
  h1{font-size:26px}
}
</style>
</head>

<body>

<div class="page">

  <!-- LEFT: PRIZE TABLE -->
  <div class="prize-card">
    <h2>üèÜ ‡∫ï‡∫≤‡∫ï‡∫∞‡∫•‡∫≤‡∫á‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</th>
          <th>‡∫à‡∫≥‡∫ô‡∫ß‡∫ô</th>
        </tr>
      </thead>
      <tbody id="prizeBody"></tbody>
    </table>
  </div>

  <!-- CENTER: GAME -->
  <div id="gameScene">
    <h1> ‡∫™‡∫∏‡ªà‡∫°‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô</h1>

    <div id="machine">
      <div class="red-arrow"></div>
      <div id="items"></div>
    </div>

    <button id="spinBtn">‡ªÄ‡ªÄ‡∫•‡ªà‡∫ô‡∫î‡ªâ‡∫≠‡∫°</button>
    <div id="lione-addon-code">LIONO----</div>
  </div>

  <!-- RIGHT: HISTORY -->
  <div id="historyBox">
    <h2>üìú ‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î</h2>
    <button id="clearHistoryBtn">.</button>
    <div id="historyList"></div>
  </div>

</div>

<!-- POPUP -->
<div id="popup" onclick="this.style.display='none'">
  <div id="popupBox">
    <img id="popupImg">
    <div id="popupCode"></div>
  </div>
</div>

<script>
/* ======================================================
   PRIZE TABLE DATA
====================================================== */
const prizes=[
 {icon:"1",name:"‡∫•‡∫ª‡∫î‡∫à‡∫±‡∫Å‡ªÑ‡∫ü‡∫ü‡ªâ‡∫≤ (‡ªÉ‡∫´‡∫ç‡ªà)",qty:"1 ‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô",big:true},
 {icon:"2",name:"‡∫•‡∫ª‡∫î‡∫à‡∫±‡∫Å‡ªÑ‡∫ü‡∫ü‡ªâ‡∫≤ (‡∫ô‡ªâ‡∫≠‡∫ç)",qty:"1 ‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô"},
 {icon:"3",name:"‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î 30,000,000 ‡∫Å‡∫µ‡∫ö",qty:"1 ‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô",big:true},
 {icon:"4",name:"‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î 1,000,000 ‡∫Å‡∫µ‡∫ö",qty:"3 ‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô"},
 {icon:"5",name:"‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î 500,000 ‡∫Å‡∫µ‡∫ö",qty:"4 ‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô"},
 {icon:"6",name:"‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î 100,000 ‡∫Å‡∫µ‡∫ö",qty:"10 ‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô"}
];
const prizeBody=document.getElementById("prizeBody");
prizes.forEach((p,i)=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${p.icon||i+1}</td>
    <td class="prize-name">${p.name}</td>
    <td><span class="badge ${p.big?'big':''}">${p.qty}</span></td>
  `;
  prizeBody.appendChild(tr);
});

/* ======================================================
   DATA (ADMIN COMPATIBLE)
====================================================== */
const rewardMap=JSON.parse(localStorage.getItem("rewardMap"))||[
 {code:"LIONO0001",img:"r1.jpg"},
 {code:"LIONO0002",img:"r2.jpg"},
 {code:"LIONO0003",img:"r3.jpg"},
 {code:"LIONO0004",img:"r4.jpg"}
];
let rewardPool=JSON.parse(localStorage.getItem("rewardPool"));
if(!rewardPool||rewardPool.length===0){
  rewardPool=rewardMap.map((_,i)=>i);
  localStorage.setItem("rewardPool",JSON.stringify(rewardPool));
}

/* ======================================================
   ELEMENTS
====================================================== */
const itemsEl=document.getElementById("items");
const codeEl=document.getElementById("lione-addon-code");
const popup=document.getElementById("popup");
const popupImg=document.getElementById("popupImg");
const popupCode=document.getElementById("popupCode");
const spinBtn=document.getElementById("spinBtn");
const scene=document.getElementById("gameScene");
const historyList=document.getElementById("historyList");

/* ======================================================
   AUDIO
====================================================== */
const sndLoop=new Audio("spin-loop.mp3");
const sndWin=new Audio("win.mp3");
sndLoop.loop=true;

/* ======================================================
   INIT SLOT
====================================================== */
function initSlot(){
  itemsEl.innerHTML="";
  for(let r=0;r<4;r++){
    rewardMap.forEach(rew=>{
      const d=document.createElement("div");
      d.className="item";
      d.innerHTML=`<img src="${rew.img}">`;
      itemsEl.appendChild(d);
    });
  }
}
initSlot();

/* ======================================================
   RANDOM CODE
====================================================== */
let raf,randomRunning=false;
function startRandomCode(){
  randomRunning=true;
  function loop(){
    if(!randomRunning)return;
    codeEl.innerText="LIONO"+String(Math.floor(Math.random()*9999)).padStart(4,"0");
    raf=requestAnimationFrame(loop);
  }loop();
}
function stopRandomCode(code){
  randomRunning=false;
  cancelAnimationFrame(raf);
  codeEl.innerText=code;
}

/* ======================================================
   CONFETTI
====================================================== */
function confettiBurst(n=120){
  for(let i=0;i<n;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    c.style.animationDuration=2+Math.random()*2+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),4000);
  }
}

/* ======================================================
   VOICE (TH)
====================================================== */
const thaiLetters={A:"‡πÄ‡∏≠",B:"‡∏ö‡∏µ",C:"‡∏ã‡∏µ",D:"‡∏î‡∏µ",E:"‡∏≠‡∏µ",F:"‡πÄ‡∏≠‡∏ü",G:"‡∏à‡∏µ",H:"‡πÄ‡∏≠‡∏ä",I:"‡πÑ‡∏≠",J:"‡πÄ‡∏à",K:"‡πÄ‡∏Ñ",L:"‡πÅ‡∏≠‡∏•",M:"‡πÄ‡∏≠‡πá‡∏°",N:"‡πÄ‡∏≠‡πá‡∏ô",O:"‡πÇ‡∏≠",P:"‡∏û‡∏µ",Q:"‡∏Ñ‡∏¥‡∏ß",R:"‡∏≠‡∏≤‡∏£‡πå",S:"‡πÄ‡∏≠‡∏™",T:"‡∏ó‡∏µ",U:"‡∏¢‡∏π",V:"‡∏ß‡∏µ",W:"‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏¢‡∏π",X:"‡πÄ‡∏≠‡πá‡∏Å‡∏ã‡πå",Y:"‡∏ß‡∏≤‡∏¢",Z:"‡πÅ‡∏ã‡∏î"};
const thaiNumbers={"0":"‡∏®‡∏π‡∏ô‡∏¢‡πå","1":"‡∏´‡∏ô‡∏∂‡πà‡∏á","2":"‡∏™‡∏≠‡∏á","3":"‡∏™‡∏≤‡∏°","4":"‡∏™‡∏µ‡πà","5":"‡∏´‡πâ‡∏≤","6":"‡∏´‡∏Å","7":"‡πÄ‡∏à‡πá‡∏î","8":"‡πÅ‡∏õ‡∏î","9":"‡πÄ‡∏Å‡πâ‡∏≤"};
function speakReward(code){
  if(!("speechSynthesis"in window))return;
  speechSynthesis.cancel();
  const text="‡∏£‡∏´‡∏±‡∏™ "+code.split("").map(c=>thaiLetters[c]||thaiNumbers[c]||c).join(" ")+" ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•";
  const u=new SpeechSynthesisUtterance(text);
  u.lang="th-TH";u.rate=0.95;
  speechSynthesis.speak(u);
}

/* ======================================================
   HISTORY
====================================================== */
let rewardHistory=JSON.parse(localStorage.getItem("rewardHistory"))||[];
function renderHistory(){
  historyList.innerHTML="";
  rewardHistory.slice().reverse().forEach(h=>{
    historyList.innerHTML+=`
      <div class="history-item">
        <img src="${h.img}">
        <div>${h.code}</div>
      </div>`;
  });
}
renderHistory();
document.getElementById("clearHistoryBtn").onclick=()=>{
  if(confirm("‡∫•‡∫ª‡∫ö‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î?")){
    rewardHistory=[];
    localStorage.removeItem("rewardHistory");
    renderHistory();
  }
};

/* ======================================================
   SPIN (SYNC WITH TRANSITIONEND)
====================================================== */
spinBtn.onclick=()=>{
  if(spinBtn.disabled) return;
  if(rewardPool.length===0) return alert("‡∫•‡∫≤‡∫á‡∫ß‡∫±‡∫ô‡∫≠‡∫≠‡∫Å‡∫Ñ‡∫ª‡∫ö");

  spinBtn.disabled=true;
  scene.classList.add("zoom-in");
  startRandomCode();

  sndLoop.pause();sndLoop.currentTime=0;
  sndWin.pause();sndWin.currentTime=0;
  speechSynthesis.cancel();

  const idx=rewardPool.splice(Math.floor(Math.random()*rewardPool.length),1)[0];
  localStorage.setItem("rewardPool",JSON.stringify(rewardPool));
  const reward=rewardMap[idx];

  itemsEl.style.transition="none";
  itemsEl.style.transform="translateX(-30px)";

  setTimeout(()=>{
    sndLoop.play();
    const STEP=220;
    const center=document.getElementById("machine").offsetWidth/2;
    const stopX=(rewardMap.length*2+idx)*STEP-center+100;
    itemsEl.style.transition="transform 8s cubic-bezier(.12,.9,.2,1)";
    itemsEl.style.transform=`translateX(-${stopX}px)`;
  },50);

  const onEnd=()=>{
    itemsEl.removeEventListener("transitionend",onEnd);

    sndLoop.pause();sndLoop.currentTime=0;
    sndWin.play();
    setTimeout(()=>speakReward(reward.code),300);

    stopRandomCode(reward.code);
    confettiBurst();

    popupImg.src=reward.img;
    popupCode.innerText=reward.code;
    popup.style.display="flex";

    rewardHistory.push({code:reward.code,img:reward.img});
    localStorage.setItem("rewardHistory",JSON.stringify(rewardHistory));
    renderHistory();

    scene.classList.remove("zoom-in");
    spinBtn.disabled=false;
  };
  itemsEl.addEventListener("transitionend",onEnd);
};
</script>

</body>
</html>
